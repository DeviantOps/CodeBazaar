trigger:
  branches:
    include:
      - '*'

jobs:
- job: SecurityCheck
  displayName: 'Security Check'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true

  - script: |
      sudo apt-get update
      sudo apt-get install -y wget
      wget https://github.com/awslabs/git-secrets/archive/1.3.0.tar.gz
      tar -xvf 1.3.0.tar.gz
      cd git-secrets-1.3.0
      sudo make install
    displayName: 'Install Gitsecrets'

  - script: |
      git secrets --register-aws --global
      git secrets --install
      git secrets --scan --recursive
    displayName: 'Run Gitsecrets Scan'

  - task: SonarCloudPrepare@1
    displayName: 'Prepare SonarCloud analysis'
    inputs:
      SonarCloud: 'Your_SonarCloud_Connection_Name'
      organization: 'Your_SonarCloud_Organization'
      scannerMode: 'CLI'
      configMode: 'manual'
      cliProjectKey: 'Your_Project_Key'
      cliSources: 'src'

  - script: |
      sonar-scanner
    displayName: 'Run SonarCloud Analysis'
